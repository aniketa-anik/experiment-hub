<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Experiment Hub</title>
    <link rel="stylesheet" href="app.css?v=20260213-rbac-workspace-iter142" />
  </head>
  <body>
    <button type="button" id="globalBackBtn" class="global-back-btn" aria-label="Go back" style="display: none">
      <span class="global-back-icon">‚Üê</span>
      <span>Back</span>
    </button>

    <section id="login-page" class="view view-login" style="display: none">
      <main class="auth-shell">
        <section class="visual-panel" aria-label="Product overview">
          <div class="visual-top">
            <p class="brand">Experiment Hub</p>
          </div>

          <div class="visual-card">
            <p class="mini-label">Why teams choose us</p>
            <h2>Run faster A/B tests with confidence.</h2>
            <ul>
              <li>Launch experiments in minutes</li>
              <li>Track winning variants by conversion impact</li>
              <li>Share results across product, growth, and marketing teams</li>
            </ul>
          </div>

          <div class="visual-foot">
            <p>Test ideas faster, ship winners sooner.</p>
            <div class="dots" aria-hidden="true">
              <span></span><span></span><span class="active"></span>
            </div>
          </div>
        </section>

        <section class="form-panel" aria-label="Account form">
          <div class="form-head">
            <h1>Create your workspace</h1>
            <p>Sign in with your company account.</p>
          </div>

          <form id="authForm" class="auth-form" novalidate>
            <div class="grid-2" id="nameFields">
              <label>
                First name
                <input type="text" id="firstName" name="firstName" placeholder="Aarav" required />
              </label>
              <label>
                Last name
                <input type="text" id="lastName" name="lastName" placeholder="Sharma" required />
              </label>
            </div>

            <label>
              Work email
              <input type="email" id="email" name="email" placeholder="you@company.com" required />
            </label>

            <label id="companyField">
              Company name
              <input type="text" id="company" name="company" placeholder="Acme Labs" required />
            </label>

            <label>
              Password
              <div class="password-wrap">
                <input type="password" id="password" name="password" placeholder="Enter your password" minlength="8" required />
                <button type="button" id="togglePassword" class="eye-btn" aria-label="Show password">Show</button>
              </div>
            </label>

            <label class="terms-row" id="termsRow">
              <input type="checkbox" id="terms" required />
              <span>I agree to the <a href="#">Terms & Conditions</a> and <a href="#">Privacy Policy</a></span>
            </label>

            <button type="submit" class="primary-cta" id="submitBtn">Continue</button>

            <div class="divider" role="separator" aria-label="Alternative sign in">
              <span></span>
              <p>Or continue with</p>
              <span></span>
            </div>

            <div class="oauth-row">
              <button type="button" class="oauth-btn">Google</button>
              <button type="button" class="oauth-btn">Microsoft</button>
            </div>

            <p id="formMessage" class="form-message" aria-live="polite"></p>
            <p class="auth-switch">
              New here?
              <button type="button" id="openSignupBtn" class="auth-link-btn">Create an Account</button>
            </p>
          </form>
        </section>
      </main>
    </section>

    <section id="signup-page" class="view view-login" style="display: none">
      <main class="auth-shell">
        <section class="visual-panel" aria-label="Product overview">
          <div class="visual-top">
            <p class="brand">Experiment Hub</p>
          </div>

          <div class="visual-card">
            <p class="mini-label">Why teams choose us</p>
            <h2>Run faster A/B tests with confidence.</h2>
            <ul>
              <li>Launch experiments in minutes</li>
              <li>Track winning variants by conversion impact</li>
              <li>Share results across product, growth, and marketing teams</li>
            </ul>
          </div>

          <div class="visual-foot">
            <p>Test ideas faster, ship winners sooner.</p>
            <div class="dots" aria-hidden="true">
              <span></span><span></span><span class="active"></span>
            </div>
          </div>
        </section>

        <section class="form-panel" aria-label="Sign up form">
          <div class="form-head">
            <h1>Create your account</h1>
            <p>Set your credentials to get started.</p>
          </div>

          <form id="signupForm" class="auth-form" novalidate>
            <label>
              Full Name
              <input type="text" id="signupFullName" placeholder="Alex Rivera" required />
            </label>

            <label>
              Email Address
              <input type="email" id="signupEmail" placeholder="you@company.com" required />
            </label>

            <label>
              Role (Optional)
              <input type="text" id="signupRole" placeholder="e.g. Product Manager" />
            </label>

            <label>
              Team (Optional)
              <input type="text" id="signupTeam" placeholder="e.g. Growth" />
            </label>

            <label>
              Password
              <div class="password-wrap">
                <input type="password" id="signupPassword" placeholder="Enter your password" required />
                <button type="button" id="toggleSignupPassword" class="eye-btn" aria-label="Show password">Show</button>
              </div>
            </label>

            <label>
              Confirm Password
              <div class="password-wrap">
                <input type="password" id="signupConfirmPassword" placeholder="Confirm your password" required />
                <button type="button" id="toggleSignupConfirmPassword" class="eye-btn" aria-label="Show confirm password">
                  Show
                </button>
              </div>
            </label>

            <button type="submit" class="primary-cta">Create Account</button>
            <p id="signupMessage" class="form-message" aria-live="polite"></p>
            <p class="auth-switch">
              Already have an account?
              <button type="button" id="openLoginBtn" class="auth-link-btn">Log In</button>
            </p>
          </form>
        </section>
      </main>
    </section>

    <section id="dashboardView" class="view view-dashboard" style="display: none">
      <header class="dashboard-topbar">
        <div class="container dashboard-topbar-inner">
          <div class="dashboard-brand">
            <p class="dashboard-eyebrow">A/B Testing Platform</p>
            <button type="button" data-nav-action="home" class="dashboard-home-btn">Experiment Hub</button>
          </div>
          <div class="top-nav dashboard-nav">
            <button type="button" id="profileBtn" data-nav-action="profile" class="profile-chip" aria-label="Open profile">AR</button>
          </div>
        </div>
      </header>

      <main class="container page">
        <div class="dashboard-action-bar">
          <h2 class="section-title">Recent Experiments</h2>
          <button id="addExperimentBtn" class="btn btn-primary" type="button">+ Add New Experiment</button>
        </div>
        <div class="dashboard-head-divider" aria-hidden="true"></div>

        <div class="search-wrap dashboard-search-wrap">
          <label for="homeSearch" class="sr-only">Search experiments</label>
          <input id="homeSearch" type="search" placeholder="Search experiments by name or owner..." />
        </div>

        <section class="controls">
          <ul id="recentList" class="experiment-list"></ul>
          <p id="emptyRecent" class="empty-state" hidden>No experiments match your search.</p>
        </section>

        <div id="seeAllExperimentsWrap" class="footer-action">
          <a class="btn btn-secondary" href="experiments.html">See All Experiments</a>
        </div>

        <div class="dashboard-branding-footer">
          <p>Track, search, and launch experiments without the clutter.</p>
        </div>
      </main>
    </section>

    <section id="profileView" class="view view-profile" style="display: none">
      <header class="dashboard-topbar">
        <div class="container dashboard-topbar-inner">
          <div class="dashboard-brand">
            <p class="dashboard-eyebrow">A/B Testing Platform</p>
            <button type="button" data-nav-action="home" class="dashboard-home-btn">Experiment Hub</button>
          </div>
          <div class="top-nav dashboard-nav">
            <button type="button" data-nav-action="profile" class="profile-chip" aria-label="Open profile">AR</button>
          </div>
        </div>
      </header>

      <header class="hero compact">
        <div class="hero-glow"></div>
        <div class="container">
          <button type="button" id="profileBackBtn" class="btn btn-secondary config-inline-back-btn profile-inline-back-btn">
            <span aria-hidden="true">‚Üê</span>
            <span>Back</span>
          </button>
          <p class="eyebrow">User Profile</p>
          <h1>Profile Overview</h1>
        </div>
      </header>

      <main class="container page">
        <section class="panel profile-card">
          <h2 id="profileName">Alex Rivera</h2>
          <p id="profileRole" class="profile-sub">Role not specified</p>

          <div class="profile-grid">
            <p><strong>Team:</strong> <span id="profileTeam">Team not assigned</span></p>
            <p><strong>Email:</strong> <span id="profileEmail">admin@company.com</span></p>
            <p><strong>Experiments Run:</strong> <span id="profileExperimentsRun">0</span></p>
            <p><strong>Active Tests:</strong> <span id="profileActiveTests">0</span></p>
          </div>
          <button type="button" id="profileLogoutBtn" class="btn btn-secondary">Logout</button>

        </section>
      </main>
    </section>

    <div id="experiment-form-page" class="view" style="display: none">
      <header class="dashboard-topbar">
        <div class="container dashboard-topbar-inner">
          <div class="dashboard-brand">
            <p class="dashboard-eyebrow">A/B Testing Platform</p>
            <button type="button" data-nav-action="home" class="dashboard-home-btn">Experiment Hub</button>
          </div>
          <div class="top-nav dashboard-nav">
            <button type="button" data-nav-action="profile" class="profile-chip" aria-label="Open profile">AR</button>
          </div>
        </div>
      </header>

      <header class="hero compact">
        <div class="container">
          <div class="config-head-row">
            <button type="button" id="configBackBtn" class="btn btn-secondary config-inline-back-btn">
              <span aria-hidden="true">‚Üê</span>
              <span>Back</span>
            </button>
            <div class="workspace-switch-inline">
              <p class="workspace-switch-heading">Experiment Name</p>
              <button
                type="button"
                id="workspaceSwitcherToggle"
                class="workspace-switcher-toggle"
                aria-expanded="false"
                aria-controls="workspaceSwitcherPanel"
              >
                <span class="workspace-switcher-toggle-label">Experiment:</span>
                <span id="workspaceSwitcherLabel">New Experiment</span>
                <span class="workspace-switcher-caret" aria-hidden="true">
                  <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                    <path d="M7 10l5-5 5 5" />
                    <path d="M17 14l-5 5-5-5" />
                  </svg>
                </span>
              </button>
              <aside id="workspaceSwitcherPanel" class="workspace-switcher-panel workspace-switcher-inline-panel" aria-hidden="true">
                <div class="workspace-switcher-head">
                  <h3>Switch Experiment</h3>
                  <button
                    type="button"
                    id="workspaceSwitcherClose"
                    class="workspace-switcher-close"
                    aria-label="Close switcher"
                  >
                    √ó
                  </button>
                </div>
                <label for="workspaceSwitcherSearch" class="sr-only">Search experiments</label>
                <input
                  id="workspaceSwitcherSearch"
                  type="search"
                  placeholder="Search by name or owner..."
                  autocomplete="off"
                />
                <ul id="workspaceSwitcherList" class="workspace-switcher-list"></ul>
              </aside>
            </div>
          </div>
        </div>
      </header>

      <main class="container page">
        <div class="workspace-shell-actions">
          <nav class="workspace-tabs" aria-label="Experiment workspace tabs">
            <button type="button" class="workspace-tab is-active" data-tab="configuration">Configuration</button>
            <button type="button" class="workspace-tab" data-tab="analytics">Analytics</button>
            <button type="button" class="workspace-tab" data-tab="history">History</button>
          </nav>
        </div>

        <div class="panel workspace-panel">
          <section id="workspaceConfigurationPanel" class="workspace-content">
            <form id="experimentConfigForm" class="config-form" novalidate>
              <div class="config-top-grid">
                <label>
                  Experiment Name
                  <input type="text" name="experimentName" placeholder="e.g. Homepage Hero Test" required />
                </label>
                <label>
                  Feature Name
                  <select name="featureName" required>
                    <option value="">Select feature</option>
                    <option>Homepage Hero Banner</option>
                    <option>Pricing Page Layout</option>
                    <option>Signup Flow</option>
                    <option>Checkout CTA</option>
                    <option>Navigation Labels</option>
                    <option>Email Capture Modal</option>
                    <option>Search Experience</option>
                  </select>
                </label>
              </div>

              <div class="filter-builder-head">
                <h2 class="section-title">Customer Segmentation</h2>
                <button type="button" id="addFilterRuleBtn" class="btn btn-secondary">+ Add Filter Group</button>
              </div>
              <pre id="filterDebugPanel" class="filter-debug-panel" style="display: none"></pre>
              <div id="filterRulesContainer" class="filter-rules"></div>

              <section class="rollout-control-box">
                <h2 class="section-title">Rollout Control</h2>
                <div class="rollout-row">
                  <label for="rolloutControl">Rollout Percentage</label>
                  <input type="range" id="rolloutControl" name="rollout" min="0" max="100" value="50" />
                  <span id="rolloutValue" class="rollout-value">50%</span>
                </div>

                <div class="audience-estimator">
                  <button type="button" id="viewCountBtn" class="btn btn-secondary">üîç View Count</button>
                  <span id="countSpinner" class="count-spinner" aria-hidden="true"></span>
                  <span id="audienceCountLabel" class="audience-count-label">Target Audience: -- users</span>
                </div>
              </section>

              <section class="test-logic-box">
                <h2 class="section-title">Test Logic</h2>
                <div class="test-row">
                  <select id="testTargetType" name="testTargetType" class="test-target-type" aria-label="Override type">
                    <option value="user_id" selected>User ID</option>
                    <option value="email">Email</option>
                  </select>
                  <input type="text" id="testUserIdInput" name="testUserId" placeholder="Enter User ID (UUID)" />
                  <button type="button" id="testBtn" class="btn btn-primary">Test</button>
                </div>
                <p id="testMessage" class="form-message test-message" aria-live="polite"></p>
              </section>

              <div id="scheduleWrap" class="schedule-wrap" style="display: none">
                <label>
                  Start Time
                  <input type="datetime-local" name="scheduleAt" />
                </label>
              </div>

              <div class="config-footer">
                <button type="button" id="publishExperimentBtn" class="btn btn-primary">Publish Experiment</button>
                <button type="button" id="pauseResumeBtn" class="btn btn-warning" style="display: none">Pause Experiment</button>
                <button type="button" id="scheduleBtn" class="btn btn-secondary">Schedule</button>
                <button type="button" id="saveDraftBtn" class="btn btn-secondary workspace-save-draft">Save Draft</button>
              </div>
            </form>
          </section>

          <section id="workspaceAnalyticsPanel" class="workspace-content" style="display: none">
              <div class="analytics-header">
              <div>
                <h2 id="analyticsExperimentName">Experiment Name</h2>
                <p id="analyticsFeatureName" class="analytics-sub">Feature Name</p>
              </div>
              <div class="analytics-header-right">
                <button type="button" id="downloadAnalyticsPdfBtn" class="btn btn-secondary analytics-download-btn">Download PDF</button>
                <span id="analyticsStatusBadge" class="status saved">Saved</span>
                <span id="analyticsRollout" class="rollout-pill">0%</span>
              </div>
            </div>

            <div id="analyticsEmptyState" class="analytics-empty" style="display: none">
              <div class="analytics-empty-illustration">üìà</div>
              <p>We're collecting data. Check back after the experiment starts.</p>
            </div>

            <div id="analyticsDataSections">
              <section class="analytics-card">
                <div class="metric-sticky analytics-view-head">
                  <div class="analytics-selector-row">
                    <label>
                      Metric
                      <select id="analyticsMetricSelect">
                        <option value="activation" selected>Activation</option>
                        <option value="retention">Retention</option>
                      </select>
                    </label>
                    <label>
                      Format
                      <select id="analyticsFormatSelect">
                        <option value="table" selected>Table</option>
                        <option value="chart">Chart</option>
                      </select>
                    </label>
                  </div>
                </div>
              </section>

              <section id="analyticsChartCard" class="analytics-card">
                <div class="trend-header">
                  <h3 id="analyticsChartTitle">Activation Trend (D0-D7)</h3>
                </div>
                <canvas id="analyticsTrendChart" height="120"></canvas>
              </section>

              <section id="analyticsTablesCard" class="analytics-card" style="display: none">
                <h3 id="analyticsTableTitle">Activation Cohorts (Last 7 Days)</h3>
                <p class="analytics-sub analytics-section-label analytics-delta-title">Net Impact (Test vs. Control)</p>
                <div class="table-wrap">
                  <table class="cohort-table cohort-table-delta">
                    <thead>
                      <tr>
                        <th>Cohort Date</th>
                        <th>D0</th>
                        <th>D1</th>
                        <th>D2</th>
                        <th>D3</th>
                        <th>D4</th>
                        <th>D5</th>
                        <th>D6</th>
                        <th>D7</th>
                      </tr>
                    </thead>
                    <tbody id="deltaCohortBody"></tbody>
                  </table>
                </div>

                <p class="analytics-sub analytics-section-label">Control</p>
                <div class="table-wrap">
                  <table class="cohort-table cohort-table-main">
                    <thead>
                      <tr>
                        <th>Cohort Date</th>
                        <th>Users</th>
                        <th>D0</th>
                        <th>D1</th>
                        <th>D2</th>
                        <th>D3</th>
                        <th>D4</th>
                        <th>D5</th>
                        <th>D6</th>
                        <th>D7</th>
                      </tr>
                    </thead>
                    <tbody id="controlCohortBody"></tbody>
                  </table>
                </div>

                <p class="analytics-sub analytics-section-label">Test</p>
                <div class="table-wrap">
                  <table class="cohort-table cohort-table-main">
                    <thead>
                      <tr>
                        <th>Cohort Date</th>
                        <th>Users</th>
                        <th>D0</th>
                        <th>D1</th>
                        <th>D2</th>
                        <th>D3</th>
                        <th>D4</th>
                        <th>D5</th>
                        <th>D6</th>
                        <th>D7</th>
                      </tr>
                    </thead>
                    <tbody id="testCohortBody"></tbody>
                  </table>
                </div>
              </section>

              <p id="analyticsNoData" class="empty-state" hidden>No cohort data found for this experiment in the last 7 days.</p>
            </div>
          </section>

          <section id="workspaceHistoryPanel" class="workspace-content" style="display: none">
            <div class="history-panel">
              <h3>History</h3>
              <p class="history-subtitle">All changes to this experiment are tracked here.</p>
              <p id="historyEmpty" class="empty-state" hidden>No history yet. Save or publish this experiment to create entries.</p>
              <ul id="historyTimeline" class="history-timeline"></ul>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div id="unsavedSwitchModal" class="modal-shell" style="display: none" aria-hidden="true">
      <div class="modal-card panel">
        <div class="modal-head">
          <h2>Unsaved Changes</h2>
        </div>
        <p class="history-subtitle">
          You have unsaved changes. If you switch experiments now, those changes will be discarded unless you save.
        </p>
        <div class="config-footer">
          <button type="button" id="unsavedCancelBtn" class="btn btn-secondary">Cancel</button>
          <button type="button" id="unsavedSaveDraftBtn" class="btn btn-secondary">Save Draft & Switch</button>
        </div>
      </div>
    </div>

    <div id="metadataModal" class="modal-shell" style="display: none" aria-hidden="true">
      <div class="modal-card panel">
        <div class="modal-head">
          <h2>Manage Filter Definitions</h2>
          <button type="button" id="closeMetadataBtn" class="btn btn-secondary">Close</button>
        </div>

        <form id="metadataForm" class="metadata-form" novalidate>
          <label>
            Field Name
            <input type="text" id="metaFieldName" placeholder="e.g. New City Flag" required />
          </label>

          <label>
            Data Type
            <select id="metaDataType">
              <option value="dropdown">Dropdown</option>
              <option value="text">Text</option>
              <option value="date">Date</option>
            </select>
          </label>

          <label>
            Allowed Values (CSV)
            <input type="text" id="metaAllowedValues" placeholder="e.g. New York, London, Tokyo" />
          </label>

          <div class="config-footer">
            <button type="submit" class="btn btn-primary">Save Definition</button>
          </div>
        </form>

        <div class="definition-list-wrap">
          <h3>Current Definitions</h3>
          <ul id="metadataList" class="definition-list"></ul>
        </div>
      </div>
    </div>

    <div id="appToast" class="app-toast" aria-live="polite"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="data.js?v=20260213-rbac-workspace-iter142"></script>
    <script src="app.js?v=20260213-rbac-workspace-iter142"></script>
  </body>
</html>
